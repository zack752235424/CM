<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Track</title>
<style type="text/css">
    html{height:100%}
    body{height:100%;margin:0px;padding:0px}
    #controller{width:100%; border-bottom:3px outset; height:30px; filter:alpha(Opacity=100); -moz-opacity:1; opacity:1; z-index:10000; background-color:white;}
    #container{height:100%}
</style>
<script type="text/javascript" src="//api.map.baidu.com/api?v=2.0&ak=vdwlUnwtXAAl0zuQQM2C5MdhLhfLZqcX"></script>
<script language="javascript" type="text/javascript" src="/static/My97DatePicker/WdatePicker.js"></script>
<script type="text/javascript" src="/static/js/jquery.js"></script>
</head>

<body>
    <div id="controller">
        <form action="{% url 'playback:search' %}" method="get">
            <input style="margin-left: 5px; height: 18px" type="text" placeholder="请输入VIN" name="VIN">
            <input style="width: 14.5%" class="Wdate" type="text" onClick="WdatePicker({el:this,dateFmt:'yyyy-MM-dd HH:mm:ss'})" name="stime">
            <span style="font-size:15px;">到</span>
            <input style="width: 14.5%" class="Wdate" type="text" onClick="WdatePicker({el:this,dateFmt:'yyyy-MM-dd HH:mm:ss'})" name="etime">
            <input id="search" type="button" value="查询">
            <input style="margin-left: 30%;" id="follow" type="checkbox"><span style="font-size:12px;">画面跟随</span>
            <input id="play" type="button" value="播放" onclick="play();" disabled />
            <input id="pause" type="button" value="暂停" onclick="pause();" disabled />
            <input id="reset" type="button" value="重置" onclick="reset()" disabled />
        </form>
    </div>
    <div id="container"></div>

<script type="text/javascript">
    $('#search').onclick(function () {
        
    });
var map;   //百度地图对象
var car;   //汽车图标
var label; //信息标签
var centerPoint;

var timer;     //定时器
var index = 0; //记录播放到第几个point

var followChk, playBtn, pauseBtn, resetBtn; //几个控制按钮


// 初始化地图
followChk = document.getElementById("follow");
playBtn = document.getElementById("play");
pauseBtn = document.getElementById("pause");
resetBtn = document.getElementById("reset");

//初始化地图,选取第一个点为起始点
map = new BMap.Map("container");
map.centerAndZoom(new BMap.Point(116.350658, 39.938888), 5);
map.enableScrollWheelZoom();
map.addControl(new BMap.NavigationControl());
map.addControl(new BMap.ScaleControl());
map.addControl(new BMap.OverviewMapControl({isOpen: true}));


function routing() {

    // 创建polyline对象
    points = [
        new BMap.Point(116.350658, 39.938888),
        new BMap.Point(116.386446, 39.939281),
        new BMap.Point(116.389034, 39.913828),
        new BMap.Point(116.442501, 39.914603),
        new BMap.Point(116.350658, 39.938888)
    ];
    var polyline = new BMap.Polyline(points, {strokeColor: "gray", strokeWeight: 8, strokeOpacity: 1});
    map.addOverlay(polyline); // 增加折线
    //显示小车子
    var icon = new BMap.Icon('/static/images/car1.png', new BMap.Size(17, 32));
    icon.imageSize = new BMap.Size(17, 30);
    icon.anchor = new BMap.Size(17, 25);
    label = new BMap.Label("", {offset: new BMap.Size(-20, -20)});
    car = new BMap.Marker(points[0]);
    car.setLabel(label);
    car.setIcon(icon);
    map.addOverlay(car);

    //将画面移动到中间
    centerPoint = new BMap.Point((points[0].lng + points[points.length - 1].lng) / 2, (points[0].lat + points[points.length - 1].lat) / 2);
    map.panTo(centerPoint);

    //点亮操作按钮
    playBtn.disabled = false;
    resetBtn.disabled = false;
}
// 开始按钮
function play() {
    playBtn.disabled = true;
    pauseBtn.disabled = false;

    //动画效果
    var sy = new BMap.Symbol(BMap_Symbol_SHAPE_BACKWARD_OPEN_ARROW, {
        scale: 0.6,//图标缩放大小
        strokeColor: '#fff',//设置矢量图标的线填充颜色
        strokeWeight: '2',//设置线宽
    });
    var icons = new BMap.IconSequence(sy, '10', '30');

    var point = points[index];
    if(index > 0) {
        map.addOverlay(new BMap.Polyline([points[index - 1], point], {
        enableEditing: false,//是否启用线编辑，默认为false
        enableClicking: true,//是否响应点击事件，默认为true
        icons: [icons],
        strokeWeight: '8',//折线的宽度，以像素为单位
        strokeOpacity: 0.8,//折线的透明度，取值范围0 - 1
        strokeColor: "#18a45b"//折线颜色
    }));
    }
    label.setContent("经度: " + point.lng + "<br>纬度: " + point.lat);
    car.setPosition(point);
    index++;
    if(followChk.checked) {
        map.panTo(point);
    }
    if(index < points.length) {
        timer = window.setTimeout("play(" + index + ")", 2000);
    } else {
        playBtn.disabled = true;
        pauseBtn.disabled = true;
        map.panTo(point);
    }
}

// 暂停按钮
function pause() {
    playBtn.disabled = false;
    pauseBtn.disabled = true;

    if(timer) {
        window.clearTimeout(timer);
    }
}

// 重置按钮
function reset() {
    followChk.checked = false;
    playBtn.disabled = false;
    pauseBtn.disabled = true;

    if(timer) {
        window.clearTimeout(timer);
    }
    index = 0;
    car.setPosition(points[0]);
    map.panTo(centerPoint);
}
</script>
</body>
</html>