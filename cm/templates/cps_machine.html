<!DOCTYPE html>
<html>
  
  <head>
    <meta charset="UTF-8">
    <title>欢迎页面-L-admin1.0</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi" />
    <link rel="stylesheet" href="/static/css/font.css">
    <link rel="stylesheet" href="/static/css/xadmin.css">
    <script src="/static/js/jquery-1.11.3.min.js"></script>
    <script language="javascript" type="text/javascript" src="/static/My97DatePicker/WdatePicker.js"></script>
    <script type="text/javascript" src="/static/js/layui.js" charset="utf-8"></script>
    <script type="text/javascript" src="/static/js/xadmin.js"></script>
  </head>
  
  <body class="layui-anim layui-anim-up">
    <div class="x-body">
      <div class="demoTable">
          <div class="layui-inline">
            <input class="layui-input" name="ICCID" id="demoReload" autocomplete="off">
          </div>
          <button class="layui-btn" data-type="reload">搜索</button>
      </div>
    </div>
    <xblock>
        <button class="layui-btn" onclick="x_admin_show('添加设备','{% url 'machine:machine_add' %}',600,400)"><i class="layui-icon"></i>添加</button>
        <button class="layui-btn" onclick="x_admin_show('导入','{% url 'machine:machine_upload' %}',600,400)"><i class="layui-icon"></i>导入</button>
    </xblock>

  <table class="layui-hide" id="test" lay-filter="test"></table>
    <script type="text/html" id="barDemo">
        <a style="background-color: royalblue" id="analysis_data" class="layui-btn layui-btn-xs analysis_data" lay-event="edit">编辑</a>
        <a style="background-color: red" id="analysis_data" class="layui-btn layui-btn-xs analysis_data" lay-event="del">删除</a>
    </script>
    <script>
        layui.use('table', function(){
          var table = layui.table;
          table.render({
            elem: '#test'
            ,url:'/machine/get_machine'
            ,toolbar: '#toolbarDemo'
            ,title: '设备数据表'
            ,cols: [[
              {type: 'checkbox', fixed: 'left'}
              ,{field:'id', title:'ID', width:80, fixed: 'left', unresize: true, sort: true, align:'center'}
              ,{field:'ICCID', title:'ICCID', align:'center', edit: 'text', templet: function(res){
                return '<em>'+ res.ICCID +'</em>'
              }}
              ,{field:'product_num', title:'货号', align:'center'}
              ,{field:'serial_num', title:'流水号', align:'center'}
              ,{field:'birthday', title:'出厂日期', align:'center'}
              ,{field:'create_time', title:'添加日期', align:'center'}
              ,{field:'dept', title:'部门', align:'center'}
              ,{fixed: 'right', title:'操作', toolbar: '#barDemo', align:'center'}
            ]]
              ,id: 'testReload'
            ,page: true
          });
          //监听行工具事件
          table.on('tool(test)', function(obj){
            var data = obj.data;
            if(obj.event === 'del'){
              layer.confirm('真的删除行么', function(index){
                $.ajax({
                    url: '/machine/machine_del?ICCID=' + data.ICCID,
                    dataType: 'json',
                    type: 'GET',
                    timeout: 2000,
                    success: function (e) {
                        obj.del();
                        layer.close(index);
                    },
                    error: function () {
                    }
                });
              });

            } else if(obj.event === 'edit'){
                parent.layer.open({
                  type: 2,
                  area: ['30%', '400px'],
                  maxmin: true, //允许全屏最小化
                  anim: 0, //0-6的动画形式，-1不开启
                  content: '/machine/machine_edit/?ICCID=' + data.ICCID
                });
            }
          });
          var $ = layui.$, active = {
            reload: function(){
              var demoReload = $('#demoReload');

              //执行重载
              table.reload('testReload', {
                where: {
                  key: {
                    ICCID: demoReload.val()
                  }
                }
              }, 'data');
            }
          };
          $('.demoTable .layui-btn').on('click', function(){
            var type = $(this).data('type');
            active[type] ? active[type].call(this) : '';
          });
        });
    </script>
  </body>
</html>